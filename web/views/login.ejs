<div class="min-h-[73vh] w-full flex items-center justify-center px-4 py-8">
    <div class="w-full max-w-md">
        <div class="bg-white border-2 border-gray-200 rounded-2xl shadow-2xl p-6 sm:p-8">
            <div class="text-center mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Welcome Back</h1>
                <p class="text-sm text-gray-600 font-semibold">Please login to your account</p>
            </div>

            <form id="loginForm" method="POST" action="/login" class="space-y-4">

                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <% fieldList.forEach(field=> { %>
                    <div class="w-full">
                        <label class="block mb-2">
                            <span class="flex items-center gap-2 text-gray-700">
                                <i class="<%= field.icon %>"></i>
                                <span>
                                    <%= field.title %>
                                </span>
                            </span>
                        </label>
                        <input type="<%= field.type %>" name="<%= field.name || field.title.toLowerCase() %>"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Enter <%= field.title.toLowerCase() %>" required />
                    </div>
                    <% }) %>

                        <div class="flex items-center justify-between text-sm">
                            <a href="/forgot-password" class="text-blue-600 hover:text-blue-700 hover:underline">
                                Forgot password?
                            </a>
                        </div>

                        <button type="submit" id="loginBtn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
                            <span>Login</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>

                        <div class="text-center text-sm">
                            <span class="text-gray-600">Don't have an account?</span>
                            <a href="/register" class="text-blue-600 hover:text-blue-700 hover:underline ml-1">Sign
                                up</a>
                        </div>
            </form>
        </div>
    </div>
</div>


<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const form = e.target;
        const btn = document.getElementById('loginBtn');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        // Validation
        if (!data.email || !data.password) {
            toaster.error('Please fill in all fields', 'Validation Error');
            return;
        }

        // Show loading
        btn.disabled = true;
        btn.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Logging in...';

        try {
            const response = await fetch('<%= baseUrl %>/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                // Success
                toaster.success('Redirecting to dashboard...', 'Login Successful');
                const data = result?.data;

                document.cookie = `accessToken=${data.jwt}; path=/; max-age=${60 * 15}`; // 60 sec * 15 -> 15min 

                console.log('result => ', result)
                btn.disabled = false;
                btn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right ml-2"></i>';
                setTimeout(() => {
                    window.location.href = result.redirectUrl || '/dashboard';
                }, 1000);
            } else {
                // Error
                toaster.error('Login failed. Please try again.', 'Authentication Failed');
                // form reset 
                form.reset();
                // Reset button
                btn.disabled = false;
                btn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right ml-2"></i>';
            }

        } catch (error) {

            toaster.error('Please check your connection and try again.', 'Network Error');

            // Reset button
            btn.disabled = false;
            btn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right ml-2"></i>';
        }
    });
</script>